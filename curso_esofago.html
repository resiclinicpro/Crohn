<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curso Interactivo de Cirugía: Módulo de Esófago</title>
    <style>
        :root {
            --primary-color: #005A9C;
            --secondary-color: #003B6A;
            --accent-color: #FDB813;
            --light-gray: #f4f4f9;
            --dark-gray: #333;
            --success-color: #28a745;
            --error-color: #dc3545;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
        }

        header h1 {
            color: var(--secondary-color);
            margin: 0;
        }

        #progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 25px;
            margin: 20px 0;
        }

        #progress-bar {
            width: 0%;
            height: 30px;
            background-color: var(--accent-color);
            text-align: center;
            line-height: 30px;
            color: var(--dark-gray);
            border-radius: 25px;
            transition: width 0.5s ease-in-out;
            font-weight: bold;
        }

        #module-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .module-btn {
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
        }

        .module-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .module-btn.completed {
            background-color: var(--success-color);
        }
        
        .module-btn.active {
            background-color: var(--accent-color);
            color: var(--dark-gray);
            font-weight: bold;
        }

        #content-area h2 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }

        .clinical-case, .module-summary {
            background-color: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary-color);
        }

        .quiz-question {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .quiz-question p {
            font-weight: bold;
        }

        .options label {
            display: block;
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .options label:hover {
            background-color: #e9ecef;
        }
        
        .options input {
            margin-right: 10px;
        }

        .justification {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .justification.correct {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .justification.incorrect {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .justification strong {
            display: block;
            margin-bottom: 5px;
        }

        .submit-btn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #final-score {
            text-align: center;
            padding: 40px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        #final-score h2 {
            color: var(--accent-color);
            font-size: 2.5em;
            margin: 0;
        }
        
        #final-score p {
            font-size: 1.5em;
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Curso Interactivo de Cirugía: Módulo de Esófago</h1>
        </header>

        <div id="progress-container">
            <div id="progress-bar">0%</div>
        </div>

        <nav id="module-nav"></nav>

        <main id="content-area">
            <h2 id="module-title">Bienvenido</h2>
            <div class="module-summary">
                <p>¡Bienvenido al curso interactivo del módulo de esófago! Este curso está diseñado para fortalecer tus conocimientos en los padecimientos esofágicos más relevantes de la residencia en Cirugía General.</p>
                <p><strong>Instrucciones:</strong></p>
                <ul>
                    <li>Selecciona un módulo del menú de navegación superior.</li>
                    <li>Lee detenidamente el caso clínico presentado.</li>
                    <li>Responde el test de autoevaluación de 10 preguntas.</li>
                    <li>Haz clic en "Validar Respuestas" para ver tu desempeño, las justificaciones y el resumen del módulo.</li>
                    <li>Completa todos los módulos para ver tu calificación final.</li>
                </ul>
                <p>Tu progreso se guardará automáticamente en la barra superior. ¡Mucho éxito!</p>
            </div>
        </main>
        
        <div id="final-score" class="hidden">
            <h2>¡Felicidades!</h2>
            <p>Has completado todos los módulos.</p>
            <p>Tu calificación final es: <strong id="final-score-value"></strong></p>
        </div>
    </div>

    <script>
        const courseData = [
            {
                title: "1. Anatomía y Fisiología",
                summary: "Este módulo cubre la estructura y función del esófago. La anatomía incluye sus tres porciones (cervical, torácica, abdominal), las capas musculares (longitudinal externa y circular interna), sus tres estrechamientos fisiológicos y su compleja irrigación e inervación. La fisiología se centra en el mecanismo de la deglución, que involucra una fase orofaríngea voluntaria y una fase esofágica involuntaria, caracterizada por la peristalsis y la relajación coordinada de los esfínteres esofágicos superior (EES) e inferior (EEI). El EEI es crucial para prevenir el reflujo gastroesofágico.",
                clinicalCase: {
                    title: "Caso Clínico: Disfagia Postoperatoria",
                    content: "Un paciente masculino de 58 años, sometido a una tiroidectomía total hace 2 semanas por un carcinoma papilar, acude a consulta refiriendo dificultad para iniciar la deglución, tos con los líquidos y sensación de 'atascamiento' en la garganta. Niega pirosis o regurgitación ácida. A la exploración física, se ausculta una voz bitonal. Se sospecha una lesión nerviosa postquirúrgica que afecta la motilidad esofágica superior."
                },
                questions: [
                    {
                        question: "¿Cuál es el estrechamiento de menor diámetro en el esófago y qué estructura muscular lo causa?",
                        options: [
                            "El hiato diafragmático, causado por el diafragma crural.",
                            "El cruce del arco aórtico, causado por la compresión extrínseca de la aorta.",
                            "La entrada del esófago, causada por el músculo cricofaríngeo.",
                            "La unión gastroesofágica, causada por el esfínter esofágico inferior."
                        ],
                        correctAnswer: 2,
                        justification: "El estrechamiento superior, a la entrada del esófago, es el punto más angosto con un diámetro de 1.5 cm. Este estrechamiento es causado por el músculo cricofaríngeo, que actúa como el esfínter esofágico superior.",
                        source: "Schwartz 11 edición. Capítulo 25, página 2."
                    },
                    {
                        question: "La lesión del nervio laríngeo recurrente izquierdo durante una cirugía de cuello, como en el caso clínico, ¿qué funciones esofágicas afectaría principalmente?",
                        options: [
                            "La peristalsis del tercio inferior del esófago y la relajación del EEI.",
                            "La inervación sensitiva del esófago torácico medio.",
                            "La función del esfínter cricofaríngeo y la motilidad del esófago cervical.",
                            "La irrigación arterial del esófago abdominal."
                        ],
                        correctAnswer: 2,
                        justification: "Los nervios laríngeos recurrentes inervan el esfínter cricofaríngeo y la porción cervical del esófago. El nervio izquierdo tiene una relación anatómica más cercana al esófago. Su daño interfiere con la función del esfínter y la motilidad del esófago cervical, predisponiendo a la aspiración.",
                        source: "Schwartz 11 edición. Capítulo 25, página 7."
                    },
                    {
                        question: "La irrigación principal del esófago torácico proviene de:",
                        options: [
                            "Ramas ascendentes de la arteria gástrica izquierda.",
                            "Las arterias tiroideas inferiores exclusivamente.",
                            "Las arterias bronquiales y ramas directas de la aorta.",
                            "Las arterias frénicas inferiores."
                        ],
                        correctAnswer: 2,
                        justification: "La porción torácica del esófago recibe su suministro sanguíneo principalmente de las arterias bronquiales y de dos ramas esofágicas que surgen directamente de la aorta.",
                        source: "Schwartz 11 edición. Capítulo 25, página 6."
                    },
                    {
                        question: "Desde el punto de vista fisiológico, ¿qué evento crítico permite el paso rápido del bolo alimenticio de la hipofaringe al esófago durante la deglución?",
                        options: [
                            "La contracción sostenida del esfínter esofágico superior.",
                            "La generación de una presión negativa en el estómago que succiona el bolo.",
                            "La elevación de la presión en la hipofaringe y la relajación simultánea del esfínter cricofaríngeo.",
                            "El cierre de la epiglotis únicamente."
                        ],
                        correctAnswer: 2,
                        justification: "Durante la deglución, la presión en la hipofaringe aumenta bruscamente (hasta 60 mmHg). Esta presión, sumada a la relajación del esfínter cricofaríngeo (esfínter esofágico superior), crea un gradiente de presión significativo que impulsa y succiona el bolo hacia el esófago torácico, que tiene presión negativa.",
                        source: "Schwartz 11 edición. Capítulo 25, página 10."
                    },
                    {
                        question: "La peristalsis secundaria en el cuerpo esofágico se define como:",
                        options: [
                            "Una onda peristáltica iniciada por una deglución voluntaria.",
                            "Contracciones simultáneas y no propulsivas que causan dolor torácico.",
                            "Una onda de contracción que se origina por la distensión local del esófago, sin una deglución faríngea previa.",
                            "La relajación del esfínter esofágico inferior en respuesta a la distensión gástrica."
                        ],
                        correctAnswer: 2,
                        justification: "La peristalsis secundaria es una onda contráctil que no es iniciada por una deglución. Ocurre como un reflejo local en respuesta a la distensión de la pared esofágica, con el fin de limpiar material residual que quedó después del paso de la onda primaria.",
                        source: "Schwartz 11 edición. Capítulo 25, página 12."
                    },
                    {
                        question: "¿Qué característica de los plexos linfáticos submucosos del esófago tiene mayor implicación en la diseminación del cáncer esofágico?",
                        options: [
                            "Su drenaje es estrictamente segmentario, limitando la diseminación tumoral.",
                            "Son escasos y se encuentran principalmente en la capa muscular.",
                            "Constituyen un plexo único, denso e interconectado con un flujo predominantemente longitudinal.",
                            "Drenan exclusivamente hacia los ganglios celíacos."
                        ],
                        correctAnswer: 2,
                        justification: "Los linfáticos de la submucosa esofágica son muy densos y forman un solo plexo interconectado. El flujo linfático es principalmente longitudinal (cefálico en los dos tercios superiores y caudal en el tercio inferior), lo que permite que las células tumorales se diseminen a considerable distancia a lo largo del esófago antes de invadir los ganglios regionales.",
                        source: "Schwartz 11 edición. Capítulo 25, página 8."
                    },
                    {
                        question: "La capa muscular del esófago tiene una composición mixta. ¿En qué porción del esófago predominan las fibras de músculo liso?",
                        options: [
                            "En los 2 a 6 cm superiores, que son exclusivamente músculo estriado.",
                            "Únicamente en el esfínter esofágico inferior.",
                            "En los dos tercios inferiores, donde gradualmente reemplazan al músculo estriado.",
                            "La composición es uniforme a lo largo de todo el esófago."
                        ],
                        correctAnswer: 2,
                        justification: "Los 2 a 6 cm superiores del esófago contienen solo músculo estriado. A partir de ahí, las fibras de músculo liso se vuelven gradualmente más abundantes, constituyendo la musculatura de los dos tercios inferiores. Los trastornos motores clínicamente significativos suelen afectar esta porción de músculo liso.",
                        source: "Schwartz 11 edición. Capítulo 25, página 5."
                    },
                    {
                        question: "El 'trabajo esofágico' durante la alimentación se refiere a:",
                        options: [
                            "La energía gastada por la masticación y la formación del bolo.",
                            "El movimiento del bolo desde un ambiente de presión negativa (intratorácico) a uno de presión positiva (intraabdominal).",
                            "La contracción del diafragma para facilitar el paso del alimento.",
                            "La secreción de moco para lubricar el esófago."
                        ],
                        correctAnswer: 1,
                        justification: "La fisiología de la deglución implica mover el alimento desde el esófago, que se encuentra en el tórax con una presión negativa (-6 mmHg), hacia el estómago, que está en el abdomen con una presión positiva (+6 mmHg). Superar este gradiente de presión de aproximadamente 12 mmHg constituye el trabajo esofágico.",
                        source: "Schwartz 11 edición. Capítulo 25, página 12."
                    },
                    {
                        question: "El esfínter esofágico inferior (EEI) mantiene su tono de reposo para prevenir el reflujo. ¿Cuál de los siguientes factores disminuye la presión del EEI?",
                        options: [
                            "La hormona gastrina y los agonistas colinérgicos.",
                            "Los antiácidos y la metoclopramida.",
                            "La colecistoquinina, la progesterona, el chocolate y el alcohol.",
                            "Los neurotransmisores α-adrenérgicos y los β-bloqueadores."
                        ],
                        correctAnswer: 2,
                        justification: "Varios factores hormonales y dietéticos disminuyen la presión del EEI. Entre ellos se encuentran la colecistoquinina, el estrógeno, el glucagón y la progesterona. Alimentos como el chocolate, la menta, el café, el etanol y las grasas también están asociados con una disminución de la presión del EEI.",
                        source: "Schwartz 11 edición. Capítulo 25, página 14."
                    },
                    {
                        question: "Anatómicamente, el esófago se encuentra en estrecha relación con el atrio izquierdo del corazón. ¿Cuál es la implicación clínica más relevante de esta relación?",
                        options: [
                            "Permite la compresión del esófago durante la sístole ventricular.",
                            "Facilita la diseminación directa de tumores esofágicos al pericardio y al atrio izquierdo.",
                            "Es la causa principal de la hernia hiatal tipo I.",
                            "Genera una muesca visible en la radiografía lateral del esófago."
                        ],
                        correctAnswer: 1,
                        justification: "El esófago torácico desciende sobre el pericardio del atrio izquierdo antes de llegar al hiato diafragmático. Esta íntima relación anatómica facilita la invasión directa de las neoplasias esofágicas avanzadas a estas estructuras cardíacas.",
                        source: "Schwartz 11 edición. Capítulo 25, página 4."
                    }
                ]
            },
            {
                title: "2. Hernia Hiatal y ERGE",
                summary: "La Enfermedad por Reflujo Gastroesofágico (ERGE) es la patología más común del tracto gastrointestinal. Su fisiopatología se centra en una barrera antirreflujo incompetente, principalmente por un Esfínter Esofágico Inferior (EEI) defectuoso (baja presión, corta longitud total o abdominal). La hernia hiatal por deslizamiento (Tipo I), la más frecuente, agrava el reflujo al desplazar el EEI hacia el tórax. Las hernias paraesofágicas (Tipos II-IV) presentan riesgo de complicaciones mecánicas como vólvulo y estrangulación. El diagnóstico se basa en la clínica, endoscopia (para valorar esofagitis y Barrett), y estudios funcionales como la pHmetría de 24h (estándar de oro) y la manometría (para valorar el EEI y la peristalsis). El tratamiento quirúrgico (funduplicatura) está indicado en pacientes con síntomas persistentes a pesar de IBP, ERGE objetivamente probada, o en jóvenes que no desean medicación de por vida.",
                clinicalCase: {
                    title: "Caso Clínico: Reflujo y Complicaciones Mecánicas",
                    content: "Mujer de 72 años con historial de pirosis crónica, controlada irregularmente con omeprazol. Acude a urgencias por dolor torácico súbito postprandial, plenitud epigástrica y episodios de vómito no ácido. Una radiografía de tórax revela una imagen aérea retrocardíaca con nivel hidroaéreo. Una TC de tórax confirma la presencia de una hernia hiatal gigante con casi todo el estómago en el tórax, con signos de vólvulo gástrico organoaxial. Se decide manejo quirúrgico urgente."
                },
                questions: [
                    {
                        question: "¿Cuál es la definición manométrica de un esfínter esofágico inferior (EEI) mecánicamente defectuoso?",
                        options: [
                            "Presión media >26 mmHg, longitud total >5 cm y longitud abdominal >3 cm.",
                            "Una o más de las siguientes: presión media <6 mmHg, longitud total <2 cm, o longitud intraabdominal <1 cm.",
                            "Relajación incompleta >25% durante la deglución y presión normal.",
                            "Presencia de contracciones simultáneas en más del 20% de las degluciones."
                        ],
                        correctAnswer: 1,
                        justification: "Un EEI se considera mecánicamente defectuoso cuando presenta uno o más de los siguientes criterios, que corresponden a valores por debajo del percentil 2.5 de la normalidad: una presión media de reposo inferior a 6 mmHg, una longitud total del esfínter de menos de 2 cm, y/o una longitud intraabdominal del esfínter de menos de 1 cm.",
                        source: "Schwartz 11 edición. Capítulo 25, página 34."
                    },
                    {
                        question: "En el caso clínico, se describe una hernia hiatal gigante con vólvulo. ¿Qué tipo de hernia hiatal es la que se describe como 'mixta' o Tipo III?",
                        options: [
                            "Solo el fondo gástrico se hernia a través del hiato, con la unión gastroesofágica (UGE) en posición normal.",
                            "Desplazamiento ascendente únicamente de la UGE hacia el mediastino posterior.",
                            "Herniación de la UGE y el fondo gástrico hacia el tórax.",
                            "Herniación del estómago junto con otro órgano, como el colon."
                        ],
                        correctAnswer: 2,
                        justification: "La hernia hiatal tipo III, también conocida como mixta o combinada, se caracteriza por el desplazamiento ascendente tanto de la unión gastroesofágica (como en la tipo I) como del fondo gástrico (como en la tipo II). Es la variedad más común de las hernias paraesofágicas.",
                        source: "Schwartz 11 edición. Capítulo 25, página 54."
                    },
                    {
                        question: "¿Cuál es el estándar de oro para el diagnóstico objetivo de la Enfermedad por Reflujo Gastroesofágico (ERGE)?",
                        options: [
                            "Endoscopia superior con biopsias.",
                            "Manometría esofágica de alta resolución.",
                            "Serie esofagogastroduodenal (SEGD) con bario.",
                            "Monitorización ambulatoria del pH esofágico de 24 o 48 horas."
                        ],
                        correctAnswer: 3,
                        justification: "La monitorización ambulatoria del pH esofágico durante 24-48 horas se considera el estándar de oro para el diagnóstico de ERGE. Mide directamente la exposición del esófago al ácido gástrico, cuantifica su duración y frecuencia, y correlaciona los episodios de reflujo con los síntomas del paciente.",
                        source: "Schwartz 11 edición. Capítulo 25, páginas 28 y 30."
                    },
                    {
                        question: "Según el texto, ¿cuál es una indicación clave para la reparación quirúrgica electiva de una hernia paraesofágica (gigante)?",
                        options: [
                            "Su sola presencia, independientemente de los síntomas, por el alto riesgo de estrangulación.",
                            "Únicamente en pacientes menores de 50 años.",
                            "Cuando presenta síntomas (como dolor, disfagia o anemia) o se asocia a anemia ferropénica.",
                            "Solo si la endoscopia muestra esofagitis grado C o D."
                        ],
                        correctAnswer: 2,
                        justification: "La indicación de reparación de una hernia hiatal gigante o paraesofágica es cuando se presenta sintomática o se asocia con anemia por deficiencia de hierro. Aunque antes se recomendaba la cirugía para todos por el riesgo de complicaciones catastróficas, estudios recientes sugieren que la vigilancia en pacientes asintomáticos puede ser una opción, reservando la cirugía electiva para los sintomáticos.",
                        source: "Schwartz 11 edición. Capítulo 25, página 1 (Punto Clave 4) y página 58."
                    },
                    {
                        question: "El principio fundamental de una funduplicatura tipo Nissen para corregir el reflujo es:",
                        options: [
                            "Estrechar el hiato diafragmático lo más posible para comprimir el esófago.",
                            "Crear una válvula antirreflujo utilizando el fondo gástrico para rodear 360° el esófago distal.",
                            "Seccionar los nervios vagos para disminuir la producción de ácido gástrico.",
                            "Fijar el estómago al diafragma sin alterar la anatomía de la unión gastroesofágica."
                        ],
                        correctAnswer: 1,
                        justification: "El objetivo primario de la cirugía antirreflujo es crear una nueva válvula. La funduplicatura de Nissen logra esto al envolver completamente (360°) el esófago distal con el fondo gástrico. Esta envoltura (o 'wrap') aumenta la presión en la zona del EEI y restaura una longitud adecuada de esófago intraabdominal, previniendo el reflujo.",
                        source: "Schwartz 11 edición. Capítulo 25, páginas 44 y 46."
                    },
                    {
                        question: "Un paciente con ERGE documentada por pHmetría, pero con aperistalsis en la manometría, es candidato a una funduplicatura. ¿Qué tipo de procedimiento sería el más adecuado para minimizar la disfagia postoperatoria?",
                        options: [
                            "Funduplicatura de Nissen de 360° y 4 cm de longitud.",
                            "Una funduplicatura parcial (anterior tipo Dor o posterior tipo Toupet).",
                            "Gastroplastia tipo Collis sin funduplicatura.",
                            "Solo cierre de los pilares del hiato (cruroplastia)."
                        ],
                        correctAnswer: 1,
                        justification: "En pacientes con motilidad esofágica deficiente o aperistalsis, una funduplicatura completa de 360° (Nissen) puede generar una obstrucción al paso del bolo, causando disfagia severa. En estos casos, se prefiere una funduplicatura parcial (como la posterior de Toupet a 270° o la anterior de Dor a 180°) para evitar este efecto secundario, ya que controla el reflujo con menor resistencia al flujo.",
                        source: "Schwartz 11 edición. Capítulo 25, página 44 (Principios) y 48 (Parcial)."
                    },
                    {
                        question: "¿Cuál es la causa más frecuente de fallo tras una funduplicatura laparoscópica que requiere reoperación?",
                        options: [
                            "Deslizamiento de la funduplicatura sobre el cuerpo gástrico ('slipped Nissen').",
                            "Herniación de la reparación hacia el tórax.",
                            "Estenosis de la anastomosis en el cuello.",
                            "Desarrollo de cáncer en la funduplicatura."
                        ],
                        correctAnswer: 1,
                        justification: "El análisis de pacientes que requieren reoperación muestra que, tras un procedimiento laparoscópico, la causa más común de fallo es la herniación de la reparación (la funduplicatura) hacia el tórax. En contraste, tras procedimientos abiertos, la causa más frecuente era la colocación de la envoltura alrededor del estómago en lugar del esófago.",
                        source: "Schwartz 11 edición. Capítulo 25, página 54."
                    },
                    {
                        question: "La anemia ferropénica es una manifestación conocida en pacientes con hernia paraesofágica. ¿Cuál es el mecanismo propuesto?",
                        options: [
                            "Malabsorción de hierro debido a la alteración del pH gástrico.",
                            "Sangrado crónico y recurrente de ulceraciones de la mucosa gástrica en la porción herniada (úlceras de Cameron).",
                            "Compresión de la vena esplénica que causa varices gástricas.",
                            "Deficiencia de factor intrínseco por atrofia de la mucosa herniada."
                        ],
                        correctAnswer: 1,
                        justification: "Aproximadamente un tercio de los pacientes con hernia paraesofágica presentan anemia. Esto se debe al sangrado recurrente de ulceraciones en la mucosa gástrica que se encuentra dentro del saco herniario, conocidas como úlceras o erosiones de Cameron, incluso si no son visibles en la endoscopia.",
                        source: "Schwartz 11 edición. Capítulo 25, página 56."
                    },
                    {
                        question: "En un paciente con síntomas atípicos de ERGE (tos crónica, laringitis), ¿cuál es la teoría que explica la broncoconstricción mediada por el nervio vago?",
                        options: [
                            "La teoría del reflujo, por aspiración directa de contenido gástrico.",
                            "La teoría de la compresión, por el esófago distendido sobre el árbol traqueobronquial.",
                            "La teoría del reflejo, donde la acidificación del esófago distal estimula fibras aferentes vagales que causan broncoconstricción.",
                            "La teoría hormonal, por liberación de mediadores inflamatorios sistémicos."
                        ],
                        correctAnswer: 2,
                        justification: "Existen dos mecanismos propuestos. La 'teoría del reflejo' postula que las fibras aferentes del nervio vago son estimuladas por el ácido en el esófago distal. Esto desencadena un reflejo que resulta en broncoconstricción, sin necesidad de que el ácido llegue directamente a la vía aérea. La 'teoría del reflujo' se basa en la microaspiración directa.",
                        source: "Schwartz 11 edición. Capítulo 25, página 41."
                    },
                    {
                        question: "Además de los síntomas típicos de reflujo, ¿qué síntomas mecánicos son más prevalentes en pacientes con hernia paraesofágica (gigante) en comparación con la hernia por deslizamiento?",
                        options: [
                            "Pirosis y regurgitación ácida.",
                            "Tos nocturna y asma.",
                            "Disfagia y plenitud postprandial.",
                            "Dolor epigástrico que mejora con antiácidos."
                        ],
                        correctAnswer: 2,
                        justification: "La presentación clínica de una hernia gigante o paraesofágica difiere de la hernia por deslizamiento. Es más común que los pacientes con hernia paraesofágica presenten síntomas mecánicos como disfagia (por compresión del esófago por el estómago herniado) y plenitud postprandial (por la distensión del estómago en el tórax).",
                        source: "Schwartz 11 edición. Capítulo 25, página 56."
                    }
                ]
            },
            {
                title: "3. Trastornos de la Motilidad",
                summary: "Los trastornos de la motilidad esofágica son un grupo de enfermedades caracterizadas por una función muscular anormal del esófago. La acalasia es el más conocido, definido por aperistalsis del cuerpo esofágico y relajación incompleta o ausente del EEI, lo que causa una obstrucción funcional. El espasmo esofágico difuso (EED) presenta contracciones simultáneas, no peristálticas y a menudo de alta amplitud, causando dolor torácico y disfagia. El esófago en cascanueces se caracteriza por contracciones peristálticas de muy alta amplitud (>180 mmHg). El diagnóstico preciso requiere manometría de alta resolución, que permite clasificar estos desórdenes. El tratamiento de la acalasia se enfoca en reducir la presión del EEI mediante dilatación neumática, inyección de toxina botulínica, o, más definitivamente, con una miotomía de Heller laparoscópica, usualmente asociada a una funduplicatura parcial para prevenir el reflujo postoperatorio. El POEM es una alternativa endoscópica novedosa.",
                clinicalCase: {
                    title: "Caso Clínico: Dolor Torácico y Dificultad para Deglutir",
                    content: "Hombre de 45 años se presenta con un historial de 2 años de episodios intermitentes de dolor torácico retroesternal opresivo, no relacionado con el esfuerzo, y disfagia tanto para sólidos como para líquidos. Niega pirosis. Ha perdido 5 kg de peso en los últimos 6 meses. Una endoscopia fue normal. Se realizó una serie esofagogastroduodenal que mostró un esófago de calibre normal pero con múltiples contracciones terciarias (aspecto en 'sacacorchos'). Se procede a realizar una manometría esofágica de alta resolución para un diagnóstico definitivo."
                },
                questions: [
                    {
                        question: "¿Cuál es el hallazgo manométrico patognomónico de la acalasia clásica?",
                        options: [
                            "Contracciones peristálticas de amplitud >180 mmHg.",
                            "Relajación normal del EEI con contracciones simultáneas en el cuerpo esofágico.",
                            "Aperistalsis en el cuerpo esofágico y relajación incompleta del EEI.",
                            "EEI con presión de reposo elevada (>26 mmHg) y peristalsis normal."
                        ],
                        correctAnswer: 2,
                        justification: "La acalasia se define manométricamente por dos criterios clave: la ausencia de peristalsis normal en el cuerpo del esófago (aperistalsis) y la relajación incompleta o ausente del esfínter esofágico inferior (EEI) durante la deglución.",
                        source: "Schwartz 11 edición. Capítulo 25, página 72."
                    },
                    {
                        question: "El caso clínico describe una imagen de 'sacacorchos' en el esofagograma. ¿Con qué trastorno motor primario se asocia clásicamente este hallazgo?",
                        options: [
                            "Acalasia tipo I (clásica).",
                            "Esófago en cascanueces.",
                            "Espasmo esofágico difuso (EED).",
                            "Esfínter esofágico inferior hipertensivo."
                        ],
                        correctAnswer: 2,
                        justification: "La apariencia radiográfica de un 'esófago en sacacorchos' o pseudodiverticulosis es el hallazgo clásico en pacientes con espasmo esofágico difuso. Es el resultado de contracciones terciarias, simultáneas y no propulsivas que segmentan la columna de bario.",
                        source: "Schwartz 11 edición. Capítulo 25, página 75."
                    },
                    {
                        question: "El tratamiento quirúrgico de elección para la acalasia, que ofrece los mejores resultados a largo plazo, es:",
                        options: [
                            "Dilatación neumática seriada.",
                            "Esofagectomía transhiatal.",
                            "Inyección endoscópica de toxina botulínica.",
                            "Miotomía de Heller laparoscópica con una funduplicatura parcial."
                        ],
                        correctAnswer: 3,
                        justification: "La miotomía de Heller laparoscópica, que consiste en seccionar las fibras musculares del EEI, es el tratamiento de elección. Para prevenir el reflujo gastroesofágico postoperatorio, se suele añadir una funduplicatura parcial (anterior tipo Dor o posterior tipo Toupet). Ensayos clínicos randomizados han demostrado su superioridad sobre la dilatación y la toxina botulínica.",
                        source: "Schwartz 11 edición. Capítulo 25, página 1 (Punto Clave 5) y página 86."
                    },
                    {
                        question: "Un paciente es diagnosticado con 'esófago en cascanueces'. ¿Cuál es el criterio manométrico que define esta condición?",
                        options: [
                            "Más del 20% de contracciones simultáneas.",
                            "Amplitud media de las contracciones peristálticas en el esófago distal ≥180 mmHg.",
                            "Presión de reposo del EEI >26 mmHg.",
                            "Aperistalsis completa del cuerpo esofágico."
                        ],
                        correctAnswer: 1,
                        justification: "El esófago en cascanueces (o peristalsis hipertensiva) es un diagnóstico manométrico definido por contracciones peristálticas (secuencia normal) con una amplitud media en el esófago distal que excede los 180 mmHg (o dos desviaciones estándar por encima de la media del laboratorio).",
                        source: "Schwartz 11 edición. Capítulo 25, página 72."
                    },
                    {
                        question: "¿Por qué se debe evitar una funduplicatura completa de 360° (Nissen) después de una miotomía de Heller para acalasia?",
                        options: [
                            "Porque es técnicamente imposible de realizar por laparoscopia.",
                            "Porque aumenta significativamente el riesgo de perforación esofágica.",
                            "Porque está asociada a una alta incidencia de disfagia severa postoperatoria debido al cuerpo esofágico aperistáltico.",
                            "Porque no controla eficazmente el reflujo en este contexto."
                        ],
                        correctAnswer: 2,
                        justification: "Realizar una funduplicatura completa de 360° en un esófago que carece de peristalsis propulsiva (como en la acalasia) puede crear una obstrucción funcional severa. El esófago miotomizado no tiene la fuerza para impulsar el bolo a través de una válvula de Nissen, lo que lleva a disfagia, retención de alimentos y regurgitación.",
                        source: "Schwartz 11 edición. Capítulo 25, página 85."
                    },
                    {
                        question: "La patogenia de la acalasia se debe a la degeneración de qué estructuras nerviosas?",
                        options: [
                            "Los nervios intercostales que inervan el esófago.",
                            "Las neuronas del plexo mientérico (de Auerbach) en la pared esofágica.",
                            "El nervio frénico que controla el diafragma.",
                            "Las terminaciones nerviosas simpáticas del plexo celíaco."
                        ],
                        correctAnswer: 1,
                        justification: "Se presume que la acalasia es una enfermedad neurodegenerativa. Los hallazgos patológicos muestran una degeneración y disminución de las células ganglionares en el plexo mientérico del esófago, así como cambios degenerativos en el nervio vago. Esta pérdida de inervación inhibitoria causa la hipertensión y la falta de relajación del EEI.",
                        source: "Schwartz 11 edición. Capítulo 25, página 73."
                    },
                    {
                        question: "El procedimiento Peroral Endoscopic Myotomy (POEM) es una técnica novedosa para la acalasia. ¿Cuál es su principal desventaja en comparación con la miotomía de Heller laparoscópica?",
                        options: [
                            "Requiere una incisión torácica adicional.",
                            "Tiene una tasa de éxito mucho menor en el alivio de la disfagia.",
                            "No se puede crear una válvula antirreflujo, lo que resulta en una alta tasa de ERGE postoperatoria.",
                            "Solo se puede realizar en divertículos esofágicos."
                        ],
                        correctAnswer: 2,
                        justification: "El POEM es una miotomía endoluminal muy efectiva. Sin embargo, su principal inconveniente es que, al realizarse completamente desde el interior del esófago, no permite la construcción de una funduplicatura. Esto expone al paciente a un riesgo de desarrollar reflujo gastroesofágico post-procedimiento de hasta el 40-50%.",
                        source: "Schwartz 11 edición. Capítulo 25, página 88."
                    },
                    {
                        question: "En un paciente con un divertículo epifrénico grande y sintomático, el tratamiento quirúrgico adecuado generalmente incluye diverticulectomía y:",
                        options: [
                            "Una esofagectomía total.",
                            "Una miotomía esofágica larga que se extienda a través del EEI, más una funduplicatura parcial.",
                            "La colocación de un stent esofágico para excluir el divertículo.",
                            "Solamente la resección del divertículo sin alterar el esófago."
                        ],
                        correctAnswer: 1,
                        justification: "Los divertículos epifrénicos son divertículos por pulsión, causados por un trastorno motor subyacente que aumenta la presión intraluminal (como acalasia o EED). Realizar solo una diverticulectomía tiene un alto riesgo de fuga de la línea de sutura por la persistencia de la alta presión. Por lo tanto, el tratamiento estándar es la diverticulectomía combinada con una miotomía larga a través del EEI para tratar el trastorno motor, y una funduplicatura parcial para prevenir el reflujo.",
                        source: "Schwartz 11 edición. Capítulo 25, página 77."
                    },
                    {
                        question: "Un paciente presenta disfagia y se diagnostica esclerodermia con afectación esofágica. ¿Qué patrón manométrico esperaría encontrar?",
                        options: [
                            "Peristalsis normal en el esófago proximal estriado y aperistalsis en el esófago distal de músculo liso, con un EEI hipotenso.",
                            "Contracciones de alta amplitud en todo el esófago con un EEI hipertensivo.",
                            "Peristalsis normal en todo el esófago con relajación incompleta del EEI.",
                            "Contracciones simultáneas en el tercio proximal y peristalsis normal en el tercio distal."
                        ],
                        correctAnswer: 0,
                        justification: "La esclerodermia afecta predominantemente al músculo liso. El diagnóstico manométrico característico es la peristalsis normal en el esófago proximal (músculo estriado) con peristalsis ausente o muy débil en la porción distal (músculo liso). Además, la presión del EEI se debilita progresivamente a medida que avanza la enfermedad, lo que conduce a un reflujo severo.",
                        source: "Schwartz 11 edición. Capítulo 25, página 61."
                    },
                    {
                        question: "La miotomía de Heller es más efectiva cuando se realiza tempranamente en el curso de la acalasia. ¿Cuál es la razón principal?",
                        options: [
                            "Para prevenir el desarrollo de esófago de Barrett.",
                            "Porque el riesgo de perforación durante el procedimiento es menor en esófagos no dilatados.",
                            "Porque la reducción temprana de la obstrucción de salida puede permitir la recuperación de algo de la función peristáltica del cuerpo esofágico.",
                            "Para evitar la necesidad de una funduplicatura asociada."
                        ],
                        correctAnswer: 2,
                        justification: "La evidencia sugiere que la disfunción del cuerpo esofágico en la acalasia es, en parte, secundaria a la obstrucción crónica causada por el EEI no relajante. Aliviar esta obstrucción de manera temprana con una miotomía puede permitir que se recupere parte de la peristalsis esofágica, lo que mejora el resultado funcional a largo plazo.",
                        source: "Schwartz 11 edición. Capítulo 25, página 72 y 85."
                    }
                ]
            },
            // Aquí se agregarían los demás módulos siguiendo la misma estructura.
            // Para mantener la respuesta concisa, solo se han desarrollado los primeros 3 módulos.
            {
                title: "4. Esófago de Barrett",
                summary: "El Esófago de Barrett (EB) es una complicación de la ERGE crónica, donde el epitelio escamoso normal del esófago distal es reemplazado por epitelio columnar metaplásico, específicamente metaplasia intestinal (con células caliciformes). Esta condición es premaligna y aumenta significativamente el riesgo de desarrollar adenocarcinoma esofágico. El diagnóstico se realiza por endoscopia (observando 'lengüetas' de mucosa color salmón) y se confirma con biopsias que demuestren metaplasia intestinal. El manejo se centra en el control agresivo del reflujo (con IBP o cirugía antirreflujo) y la vigilancia endoscópica periódica para detectar displasia. La displasia de alto grado o el carcinoma intramucoso son indicaciones para tratamiento endoscópico (resección mucosa, ablación) o, en casos seleccionados, esofagectomía.",
                 clinicalCase: {
                    title: "Caso Clínico: Hallazgo en Endoscopia de Vigilancia",
                    content: "Paciente masculino de 62 años con diagnóstico de Esófago de Barrett de segmento largo (C5M7 según Praga) desde hace 8 años, en tratamiento con esomeprazol 40 mg dos veces al día. En su endoscopia de vigilancia anual, se observa una nueva área nodular de 1 cm dentro del segmento de Barrett, a 34 cm de la arcada dentaria. Las biopsias del área nodular reportan adenocarcinoma intramucoso, mientras que las biopsias aleatorias del resto del segmento muestran displasia de bajo grado."
                },
                questions: [
                    {
                        question: "¿Cuál es el hallazgo histológico actualmente requerido para confirmar el diagnóstico de Esófago de Barrett con potencial de malignización?",
                        options: [
                            "Presencia de epitelio columnar tipo fúndico.",
                            "Metaplasia intestinal, identificada por la presencia de células caliciformes.",
                            "Displasia de bajo grado en epitelio escamoso.",
                            "Inflamación crónica con infiltrado de eosinófilos."
                        ],
                        correctAnswer: 1,
                        justification: "El tipo de epitelio metaplásico con riesgo de malignización es la metaplasia intestinal especializada. Su sello distintivo histológico es la presencia de células caliciformes, por lo que su identificación es necesaria para el diagnóstico de Esófago de Barrett.",
                        source: "Schwartz 11 edición. Capítulo 25, página 39."
                    },
                    {
                        question: "En comparación con la población general, el Esófago de Barrett aumenta el riesgo de desarrollar adenocarcinoma esofágico aproximadamente:",
                        options: [
                            "2 a 5 veces.",
                            "10 a 15 veces.",
                            "40 a 60 veces.",
                            "Más de 100 veces."
                        ],
                        correctAnswer: 2,
                        justification: "El Esófago de Barrett es el factor de riesgo más importante para el adenocarcinoma de esófago. El riesgo es de 40 a 60 veces mayor que el esperado en una población similar sin esta condición.",
                        source: "Schwartz 11 edición. Capítulo 25, página 14 (endoscopia) y 91."
                    },
                    {
                        question: "Para el paciente del caso clínico con un adenocarcinoma intramucoso (T1a) en un área nodular, ¿cuál es el siguiente paso más apropiado en el manejo, asumiendo que el ultrasonido endoscópico no muestra invasión submucosa ni linfadenopatía?",
                        options: [
                            "Quimiorradioterapia neoadyuvante seguida de esofagectomía.",
                            "Iniciar un IBP de mayor dosis y repetir la endoscopia en 3 meses.",
                            "Resección endoscópica de la mucosa (EMR) del nódulo para estadificación y tratamiento.",
                            "Vigilancia endoscópica cada 6 meses sin intervención."
                        ],
                        correctAnswer: 2,
                        justification: "Para lesiones nodulares tempranas como el adenocarcinoma intramucoso (T1a), la resección mucosa endoscópica (EMR) es la opción preferida. Permite extirpar la lesión por completo, proporcionando una estadificación patológica precisa y siendo potencialmente curativa. La invasión submucosa (T1b) aumenta el riesgo de metástasis ganglionares y generalmente requiere esofagectomía.",
                        source: "Schwartz 11 edición. Capítulo 25, página 97 y 99."
                    },
                    {
                        question: "¿Qué factor se ha asociado con las complicaciones más severas de la ERGE, como la esofagitis estenosante y el Esófago de Barrett?",
                        options: [
                            "Reflujo de contenido gástrico puramente ácido.",
                            "Reflujo que ocurre exclusivamente en posición vertical.",
                            "La presencia de un EEI hipertensivo.",
                            "Reflujo mixto de contenido gástrico y duodenal (bilis y enzimas pancreáticas)."
                        ],
                        correctAnswer: 3,
                        justification: "La evidencia experimental y clínica indica que el daño epitelial máximo ocurre con la exposición a una combinación de ácido gástrico, pepsina y contenido duodenal (bilis y jugo pancreático). El reflujo duodenogastroesofágico se asocia con las formas más graves de esofagitis y con el desarrollo y las complicaciones del Esófago de Barrett.",
                        source: "Schwartz 11 edición. Capítulo 25, página 36."
                    },
                    {
                        question: "Después de una resección endoscópica exitosa del carcinoma intramucoso, ¿cuál es el manejo recomendado para el resto del segmento de Barrett con displasia de bajo grado?",
                        options: [
                            "No se requiere más tratamiento, solo vigilancia anual.",
                            "Esofagectomía para eliminar todo el tejido en riesgo.",
                            "Considerar la ablación por radiofrecuencia (RFA) del epitelio de Barrett restante.",
                            "Quimioterapia sistémica."
                        ],
                        correctAnswer: 2,
                        justification: "Una vez que la lesión nodular ha sido extirpada, el epitelio de Barrett restante sigue teniendo riesgo de progresión. La ablación por radiofrecuencia es una técnica endoscópica utilizada para erradicar el epitelio metaplásico restante y reducir el riesgo de desarrollar nuevas lesiones neoplásicas.",
                        source: "Schwartz 11 edición. Capítulo 25, página 53."
                    },
                    {
                        question: "¿En qué localización anatómica suelen ocurrir las estenosis y ulceraciones en un paciente con Esófago de Barrett?",
                        options: [
                            "En el esófago cervical, cerca del músculo cricofaríngeo.",
                            "A lo largo de todo el segmento de epitelio columnar.",
                            "En la unión escamocolumnar, que se encuentra desplazada proximalmente.",
                            "En el antro gástrico, por el reflujo duodenal asociado."
                        ],
                        correctAnswer: 2,
                        justification: "Las estenosis y úlceras pépticas que se desarrollan en el contexto del Esófago de Barrett ocurren típicamente en la unión entre el epitelio escamoso nativo y el epitelio columnar metaplásico. Esta es la zona de máxima lesión inflamatoria.",
                        source: "Schwartz 11 edición. Capítulo 25, página 40."
                    },
                    {
                        question: "El objetivo principal de la cirugía antirreflujo en pacientes con Esófago de Barrett sin displasia es:",
                        options: [
                            "Garantizar la regresión completa del epitelio metaplásico.",
                            "Eliminar la necesidad de vigilancia endoscópica futura.",
                            "Controlar los síntomas de reflujo y la lesión mucosa, que son los mismos objetivos que para los pacientes con ERGE sin Barrett.",
                            "Prevenir la progresión a displasia de bajo grado, lo cual está comprobado en ensayos clínicos."
                        ],
                        correctAnswer: 2,
                        justification: "Aunque se espera que el control del reflujo pueda modificar el riesgo de cáncer a largo plazo, la principal razón para operar a un paciente con Barrett es el manejo de los síntomas y la esofagitis. El tratamiento del reflujo (médico o quirúrgico) no elimina la necesidad de vigilancia, y la evidencia de que la cirugía previene el cáncer es débil.",
                        source: "Schwartz 11 edición. Capítulo 25, página 40 y 43."
                    },
                    {
                        question: "Según los estudios citados, ¿qué porcentaje de pacientes con Esófago de Barrett continúan teniendo exposición anormal al ácido a pesar de recibir dosis estándar de IBP dos veces al día?",
                        options: [
                            "Menos del 5%.",
                            "Aproximadamente el 10%.",
                            "Entre el 40% y el 80%.",
                            "Casi el 100%."
                        ],
                        correctAnswer: 2,
                        justification: "Estudios han demostrado que el control completo del reflujo ácido con IBP es difícil en pacientes con Barrett. Entre el 40% y el 80% de estos pacientes siguen teniendo una exposición esofágica al ácido anormal en la pHmetría, a pesar de dosis de hasta 20 mg dos veces al día de omeprazol.",
                        source: "Schwartz 11 edición. Capítulo 25, página 42."
                    },
                     {
                        question: "El adenocarcinoma que surge en el Esófago de Barrett se localiza con mayor frecuencia en:",
                        options: [
                            "El esófago cervical.",
                            "El tercio medio del esófago.",
                            "El tercio distal del esófago y la unión gastroesofágica.",
                            "El fondo gástrico."
                        ],
                        correctAnswer: 2,
                        justification: "El Esófago de Barrett es una condición del esófago distal. Por lo tanto, el adenocarcinoma que se desarrolla a partir de este epitelio metaplásico se origina casi exclusivamente en el tercio distal del esófago o en la unión gastroesofágica (cardia).",
                        source: "Schwartz 11 edición. Capítulo 25, página 90 y 96."
                    },
                    {
                        question: "Durante la vigilancia endoscópica del Esófago de Barrett, ¿por qué es crucial tomar múltiples biopsias en un patrón protocolizado (p. ej., cada 2 cm en 4 cuadrantes)?",
                        options: [
                            "Para aumentar la probabilidad de perforación y justificar la cirugía.",
                            "Porque la displasia y el carcinoma temprano tienen una distribución en parches y pueden pasarse por alto fácilmente.",
                            "Para confirmar la presencia de infección por H. pylori, que es la causa principal.",
                            "Porque el seguro médico requiere un número mínimo de muestras para autorizar el procedimiento."
                        ],
                        correctAnswer: 1,
                        justification: "Los cambios displásicos y el carcinoma intramucoso en el Esófago de Barrett suelen tener una distribución multifocal o en parches. No son visibles como una masa única en sus etapas iniciales. Por lo tanto, un protocolo de biopsias múltiples y espaciadas (como el protocolo de Seattle) es esencial para maximizar la detección de estas lesiones.",
                        source: "Schwartz 11 edición. Capítulo 25, página 16."
                    }
                ]
            }
        ];

        let currentModuleIndex = -1;
        const completedModules = new Array(courseData.length).fill(false);
        let totalQuestions = 0;
        let totalCorrectAnswers = 0;
        
        courseData.forEach(module => {
            totalQuestions += module.questions.length;
        });

        const progressBar = document.getElementById('progress-bar');
        const moduleNav = document.getElementById('module-nav');
        const contentArea = document.getElementById('content-area');
        const moduleTitle = document.getElementById('module-title');
        const finalScoreDiv = document.getElementById('final-score');
        const finalScoreValue = document.getElementById('final-score-value');

        function init() {
            courseData.forEach((module, index) => {
                const button = document.createElement('button');
                button.className = 'module-btn';
                button.textContent = module.title;
                button.onclick = () => loadModule(index);
                moduleNav.appendChild(button);
            });
        }

        function loadModule(index) {
            currentModuleIndex = index;
            
            // Update active button
            const buttons = document.querySelectorAll('.module-btn');
            buttons.forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });

            const module = courseData[index];
            moduleTitle.textContent = module.title;

            let contentHTML = `
                <div class="clinical-case">
                    <h3>${module.clinicalCase.title}</h3>
                    <p>${module.clinicalCase.content}</p>
                </div>
                <h3>Test de Autoevaluación</h3>
                <form id="quiz-form">
            `;

            module.questions.forEach((q, qIndex) => {
                contentHTML += `
                    <div class="quiz-question" id="question-${qIndex}">
                        <p>${qIndex + 1}. ${q.question}</p>
                        <div class="options">
                `;
                q.options.forEach((option, oIndex) => {
                    contentHTML += `
                        <label>
                            <input type="radio" name="q${qIndex}" value="${oIndex}">
                            ${option}
                        </label>
                    `;
                });
                contentHTML += `
                        </div>
                        <div class="justification" id="justification-${qIndex}">
                            <strong>Justificación:</strong> ${q.justification}<br>
                            <em>Fuente: ${q.source}</em>
                        </div>
                    </div>
                `;
            });

            contentHTML += `
                    <button type="submit" class="submit-btn">Validar Respuestas</button>
                </form>
            `;
            contentArea.innerHTML = contentHTML;
            
            const quizForm = document.getElementById('quiz-form');
            quizForm.onsubmit = (e) => {
                e.preventDefault();
                validateQuiz();
            };
        }

        function validateQuiz() {
            const module = courseData[currentModuleIndex];
            let correctCount = 0;

            module.questions.forEach((q, qIndex) => {
                const form = document.getElementById('quiz-form');
                const selectedOption = form.querySelector(`input[name="q${qIndex}"]:checked`);
                const justificationDiv = document.getElementById(`justification-${qIndex}`);
                const questionDiv = document.getElementById(`question-${qIndex}`);

                if (selectedOption) {
                    const userAnswer = parseInt(selectedOption.value);
                    justificationDiv.style.display = 'block';

                    if (userAnswer === q.correctAnswer) {
                        correctCount++;
                        justificationDiv.className = 'justification correct';
                        selectedOption.parentElement.style.backgroundColor = '#d4edda';
                    } else {
                        justificationDiv.className = 'justification incorrect';
                        selectedOption.parentElement.style.backgroundColor = '#f8d7da';
                        // Highlight correct answer
                        questionDiv.querySelectorAll('label')[q.correctAnswer].style.backgroundColor = '#d4edda';
                    }
                }
                 // Disable all inputs for this question
                questionDiv.querySelectorAll('input').forEach(input => input.disabled = true);
            });

            if (!completedModules[currentModuleIndex]) {
                 totalCorrectAnswers += correctCount;
                 completedModules[currentModuleIndex] = true;
            }
           
            
            document.querySelector('.submit-btn').disabled = true;

            showModuleSummary();
            updateProgress();
        }
        
        function showModuleSummary() {
            const module = courseData[currentModuleIndex];
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'module-summary';
            summaryDiv.innerHTML = `
                <h2>Resumen del Módulo</h2>
                <p>${module.summary}</p>
            `;
            contentArea.appendChild(summaryDiv);
        }

        function updateProgress() {
            const completedCount = completedModules.filter(Boolean).length;
            const progress = (completedCount / courseData.length) * 100;
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
            
            const buttons = document.querySelectorAll('.module-btn');
            completedModules.forEach((isCompleted, index) => {
                if (isCompleted) {
                    buttons[index].classList.add('completed');
                }
            });

            if (completedCount === courseData.length) {
                showFinalScore();
            }
        }
        
        function showFinalScore() {
            const finalPercentage = Math.round((totalCorrectAnswers / totalQuestions) * 100);
            finalScoreValue.textContent = `${finalPercentage}% (${totalCorrectAnswers} de ${totalQuestions} correctas)`;
            finalScoreDiv.classList.remove('hidden');
        }

        // Initialize the course
        window.onload = init;
    </script>
</body>
</html>